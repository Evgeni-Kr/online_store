<!DOCTYPE html>
<html lang="ru" xml:lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Мои заказы</title>
    <link rel="stylesheet" th:href="@{/styles/orders.css}">
    <div th:replace="~{common :: styles}"></div>
    <script th:src="@{/js/burgerMenu.js}"></script>

</head>
<body>
<div th:replace="~{common :: header}"></div>

<div class="menu" id="menu">

    <ul class="burger-menu__list">
        <li class="burger-menu__item">
            <a href="#" class="burger-menu__link">Электроника</a>
        </li>
        <li class="burger-menu__item">
            <a href="#" class="burger-menu__link">Одежда</a>
        </li>
        <li class="burger-menu__item">
            <a href="#" class="burger-menu__link">Книги</a>
        </li>
        <li class="burger-menu__item">
            <a href="#" class="burger-menu__link">Спорт</a>
        </li>
        <li class="burger-menu__item">
            <a href="#" class="burger-menu__link">Красота</a>
        </li>
    </ul>
</div>

<div class="burger-menu__overlay" id="burgerMenuOverlay"></div>
<main class="orders-main">
    <div class="container">
        <h1 class="page-title">Мои заказы</h1>

        <!-- Сообщение об ошибке -->
        <div th:if="${error != null}" class="alert alert-danger">
            <span th:text="${error}"></span>
        </div>

        <div th:if="${orders != null and !orders.isEmpty()}">
            <div class="orders-list">
                <div th:each="order : ${orders}" class="order-card">
                    <div class="order-header">
                        <div class="order-info">
                            <div class="order-number">
                                <span class="label">Заказ №</span>
                                <span th:text="${order.id}" class="value"></span>
                            </div>
                            <div class="order-date">
                                <span class="label">Дата оформления:</span>
                                <span class="value" th:text="${order.orderDate}"></span>
                                <span class="value" th:unless="${order.orderDate != null}">Дата не указана</span>
                            </div>
                        </div>
                        <div class="order-status">
                            <!-- Исправленная логика отображения статуса -->
                            <span th:if="${order.status == 'processed'}"
                                  class="status-processed">Обрабатывается</span>
                            <span th:if="${order.status == 'on_the_way'}"
                                  class="status-ontheway">В пути</span>
                            <span th:if="${order.status == 'delivered'}"
                                  class="status-delivered">Доставлен</span>
                        </div>
                    </div>

                    <div class="order-items">
                        <div th:each="item : ${order.items}" class="order-item">
                            <div class="item-image">
                                <img th:if="${item.productPreviewImageId != 0}"
                                     th:src="@{/image/{id}(id=${item.productPreviewImageId})}"
                                     th:alt="${item.productName}"
                                     class="product-img">
                                <img th:unless="${item.productPreviewImageId != 0}"
                                     src="/images/placeholder.jpg"
                                     th:alt="${item.productName}"
                                     class="product-img">
                            </div>
                            <div class="item-details">
                                <h3 class="item-name" th:text="${item.productName}"></h3>
                                <div class="item-price">
                                    <span th:text="${item.price}" class="price"></span> руб. ×
                                    <span th:text="${item.quantity}" class="quantity"></span> шт.
                                </div>
                            </div>
                            <div class="item-total">
                                <span th:text="${item.totalPrice}" class="total-price"></span> руб.
                            </div>
                        </div>
                    </div>

                    <div class="order-summary">
                        <div class="summary-row">
                            <span class="label">Итого:</span>
                            <span class="value" th:text="${order.totalPrice}"></span> руб.
                        </div>
                    </div>

                    <div class="order-actions">
                        <button class="button btn-secondary">Повторить заказ</button>
                        <a th:href="@{/order/details/{id}(id=${order.id})}" class="button btn-primary">
                            Подробнее о заказе
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${orders == null or orders.isEmpty()}" class="no-orders">
            <div class="empty-state">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 7C16 5.9 15.1 5 14 5H10C8.9 5 8 5.9 8 7M16 7C17.1 7 18 7.9 18 9V19C18 20.1 17.1 21 16 21H8C6.9 21 6 20.1 6 19V9C6 7.9 6.9 7 8 7M16 7V5C16 3.3 14.7 2 13 2H11C9.3 2 8 3.3 8 5V7"
                          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <h3>У вас еще нет заказов</h3>
                <p>Совершите свою первую покупку!</p>
                <a href="/product/get/products" class="btn btn-primary">Перейти к покупкам</a>
            </div>
        </div>
    </div>
</main>


<div th:replace="~{common :: footer}"></div>
</body>
</html>